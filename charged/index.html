<!DOCTYPE html>
<meta charset="utf-8">
<style>

body {
  margin: 0;
  font-family:Helvetica, Arial, sans-serif;
  font-size: 14px;
}
header{
  background: #111;
  margin: 0;
}
h1{
  font-size: 25px;
  color:#fff;
  font-weight: lighter;
  margin:0 0 0 20px;
}
#container {
  position: relative;
  overflow: hidden;
	background: #555;
}

#map{
	width:100%;
	height:100%;
}

#points{
	width:100%;
	height:100%;
	position:relative;
	z-index:100;
}
.layer {
  position: absolute;
}

.tile {
  pointer-events: none;
  position: absolute;
  width: 256px;
  height: 256px;
}

.info {
  position: absolute;
  bottom: 0px;
  left: 0px;
	padding: 20px;
	background: #000;
	color: #fff;
	width: 100%;
	z-index: 1000;
	font-family:Helvetica, Arial, sans-serif;
	font-size:16px;
}
.hide{
  visibility: hidden;
}
.show{
  visibility: visible;
}
.tooltip {
  position: absolute;
  padding: 15px;
  font: 12px sans-serif;
  background: #fff;
  color: #000;
  border: 0px;
  border-radius: 2px;
  pointer-events: none;
  opacity: 0.8;
  visibility: hidden;
  z-index: 101;
}
.active{
  background: #fff000;
}
#legend{
  position: absolute;
  top: 105px;
  left: 30px;
  z-index: 101;
  color:#fff;
  font-weight: 400;
}
</style>
<body>
  <!-- <header><h1>police shootings</h1></header> -->

  <!-- <div id="legend">Legend</div> -->
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/d3.geo.tile.v0.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script>

var width = Math.max(960, window.innerWidth),
    height = window.innerHeight,
    prefix = prefixMatch(["webkit", "ms", "Moz", "O"]);

var tile = d3.geo.tile()
    .size([width, height]);

var projection = d3.geo.mercator()
.scale((1 << 13) / 2 / Math.PI)
.translate([-width / 2, -height / 2]); // just temporary

var tileProjection = d3.geo.mercator();

var tilePath = d3.geo.path()
    .projection(tileProjection);

var zoom = d3.behavior.zoom()
    .scale(projection.scale() * 2 * Math.PI)
    .scaleExtent([1 << 9, 1 << 25])
    .translate(projection([-95, 38]).map(function(x) { return -x; }))
    .on("zoom", zoomed);

var color = d3.scale.category20();

var container = d3.select("body").append("div")
    .attr("id", "container")
    .style("width", width + "px")
    .style("height", height + "px")
    .call(zoom);

var map = container.append("g")
    .attr("id", "map")

var points = container.append("svg")
    .attr("id", "points")

var layer = map.append("div")
    .attr("class", "layer");

var scale = zoom.scale();

zoomed();

d3.queue()
    .defer(d3.json, "https://d3js.org/us-10m.v1.json")
    .await(ready);

function ready(error, us) {
  if (error) throw error;

  svg.append("g")
      .attr("class", "counties")
    .selectAll("path")
    .data(topojson.feature(us, us.objects.counties).features)
    .enter().append("path")
      .attr("fill", '#eee')
      .attr("d", path)

  svg.append("path")
      .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
      .attr("class", "states")
      .attr("d", path);

      svg.append("path")
          .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
          .attr("class", "country")
          .attr("d", path)
          .attr('stroke','#000');
}



function drawMap(){
  d3.select('#points').remove();
  var points = container.append("svg")
      .attr("id", "points")

  d3.csv("../MPV.csv", function(error, dataset) {

  	var points = d3.select("#points")

    points.selectAll("circle").data(dataset) //plotted 	locations on map
  	.enter()
  	.append("circle")
  	.attr("cx", function(d) {return projection([d.Longitude,d.Latitude])[0]})
  	.attr("cy", function(d) {return projection([d.Longitude,d.Latitude])[1]})
  	.attr("class", "point")
  	.style("fill", function(d){
          return charged(d);
      })
      .on("mouseover", function(d) {
        var tooltip_str = d.name + ", " + d.date + '<br/>' +
        d.race + ', ' + d.age + ', ' + d.gender + '<br/>' + d.charges
        tooltip.html(tooltip_str)
            .style("visibility", "visible");
      })
      .on("mousemove", function(d) {
        tooltip.style("top", event.pageY - (tooltip.node().clientHeight + 5) + "px")
            .style("left", event.pageX - (tooltip.node().clientWidth / 2.0) + "px");
      })
      .on("mouseout", function(d) {
        points.selectAll('.month')
            .classed('active', false)
        tooltip.style("visibility", "hidden");
      })

      var tooltip = d3.select("body").append("div")
              .attr("class", "tooltip");

  	zoomed();
  });
}

drawMap();



function charged(d){
  if (d.charges == "No known charges" || d.charges == "No Known Charges" || d.charges ==
  "No" || d.charges == "NO" || d.charges ==
  "Charged, Acquitted" || d.charges ==
  "Civil Citation, But No Criminal Charges" || d.charges ==
  "Charged, Charges Tossed" || d.charges ==
  "Charged with perjury, Charges dropped" || d.charges ==
  "Charged, Mistrial" || d.charges ==
  "Charged, Mistrial, Plead Guilty to Civil Rights Charges"){return "#000"}
  else if (d.charges == "Charged with a crime" || d.charges == "Charged, Convicted, Sentenced to 40 years in prison" || d.charges ==
  "Charged, Convicted, Sentenced to 5 years in prison" || d.charges == "Charged, Convicted, Sentenced to 3 months in jail" || d.charges ==
  "Charged, Convicted, Sentenced to 30 years in prison" || d.charges == "Charged, Convicted" || d.charges ==
  "Charged, Convicted, Sentenced to 2.5 years in prison" || d.charges == "Charged, Convicted, Sentenced to 4 years" || d.charges ==
  "Charged, Convicted (two officers) of cruelty to an inmate, public records fraud, and perjury. Sentenced to one month in jail and three years’ probation" || d.charges ==
  "Charged, Convicted, Sentenced to 5 years probation." || d.charges == "Charged, Convicted, Sentenced to 20 years in prison" || d.charges ==
  "Charged, Convicted, Sentenced to 16 years in prison" || d.charges == "Charged, Convicted, Sentenced to 1 year in prison" || d.charges ==
  "Charged, Convicted, Sentenced to 4 years in prison, 3 years probation" || d.charges == "Charged, Convicted, Sentenced to life in prison without parole, plus 16 years" || d.charges ==
  "Charged, Convicted, Sentenced to life in prison" || d.charges == "Charged, Convicted, Sentenced to Life in Prison" || d.charges ==
  "Charged, Convicted, Sentenced to 7 years in prison" || d.charges == "Charged, Convicted, Sentenced to 3 years probation " || d.charges ==
  "Charged, Convicted of murder, Sentenced to 30 years in prison" || d.charges ==
  "Charged, Convicted of criminally negligent homicide, Sentenced to 1-3 years in prison" || d.charges ==
  "Charged, Convicted, Sentenced to 120 days in jail, 3 years probation" || d.charges ==
  "Charged, Convicted of involuntary manslaughter, DUI and recklessly endangering another person, Sentenced to 2-7 years" || d.charges ==
  "Charged, Convicted, Sentenced to 50 years" || d.charges ==
  "Charged, Convicted, Sentenced to 1 year in jail, 3 years suspended" || d.charges ==
  "Charged, Convicted, Sentenced to 18 months" || d.charges ==
  "Charged, Convicted, Sentenced to 6 years"){return "#ff0000"}else{return "#333"}
}
// function mentalillness(d){
//   if (d.mental_illness == "Yes") { return '#fff'}
//   else if (d.race == "No") { return '#000'}
//   else { return '#333'}
// }
// function race(d){
//   if (d.race == "White") { return '#fff'}
//   else if (d.race == "Black") { return '#000'}
//   else if (d.race == "Hispanic") { return '#1cfcff'}
//   else if (d.race == "Native American") { return '#00dd3e'}
//   else if (d.race == "Pacific Islander") { return '#fac200'}
//   else if (d.race == "Asian") { return '#0072dd'}
//   else { return '#333'}
// }
// function gender(d){
//     if (d.gender == 'Female'){ return '#ff0000'}
//     else if (d.gender == 'Male'){return '#000'}
//     else{return '#fff'}
// }
//
// function armed(d){
//     if (d.armed_unarmed == 'Unarmed'){ return '#000'}
//     else if (d.armed_unarmed == 'Allegedly Armed' ){return '#ee16b4'}
//     else{return '#666'}
// }
// function age(d){
//   if (d.age < 19){return '#ff0000'}
//   else if (d.age > 18 && d.age < 35){return '#fff000'}
//   else{ return '#0072dd'}
// }

function zoomed() {
  var tiles = tile
      .scale(zoom.scale())
      .translate(zoom.translate())
      ();

  projection
      .scale(zoom.scale() / 2 / Math.PI)
      .translate(zoom.translate());

var circles = d3.selectAll("circle")
							.attr("cx", function(d) {return projection([d.Longitude,d.Latitude])[0]})
							.attr("cy", function(d) {return projection([d.Longitude,d.Latitude])[1]})
//							.attr("r", 1.75);
              .attr("r",3)
  var image = layer
      .style(prefix + "transform", matrix3d(tiles.scale, tiles.translate))
    .selectAll(".tile")
      .data(tiles, function(d) { return d; });

  image.exit()
      .remove();

  image.enter().append("img")
      .attr("class", "tile")
      .attr("src", function(d) { return "http://tiles.wmflabs.org/bw-mapnik/" + d[2] + "/" + d[0] + "/" + d[1] + ".png"; })
      .style("left", function(d) { return (d[0] << 8) + "px"; })
      .style("top", function(d) { return (d[1] << 8) + "px"; });
}

function matrix3d(scale, translate) {
  var k = scale / 256, r = scale % 1 ? Number : Math.round;
  return "matrix3d(" + [k, 0, 0, 0, 0, k, 0, 0, 0, 0, k, 0, r(translate[0] * scale), r(translate[1] * scale), 0, 1 ] + ")";
}

function prefixMatch(p) {
  var i = -1, n = p.length, s = document.body.style;
  while (++i < n) if (p[i] + "Transform" in s) return "-" + p[i].toLowerCase() + "-";
  return "";
}

function formatLocation(p, k) {
  var format = d3.format("." + Math.floor(Math.log(k) / 2 - 2) + "f");
  return (p[1] < 0 ? format(-p[1]) + "°S" : format(p[1]) + "°N") + " "
       + (p[0] < 0 ? format(-p[0]) + "°W" : format(p[0]) + "°E");
}


</script>
</body>
</html>

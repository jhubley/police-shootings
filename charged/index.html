
<!DOCTYPE html>
<meta charset="utf-8">
<style>
html,body{
  margin:0;
  font-family: monospace;
}
body{
  padding:30px;
}
.counties {
  fill: none;
  stroke: none;
}
.counties path:hover{
  fill: #FFF77D;
}
.states {
  fill: none;
  stroke: none;
  stroke-linejoin: round;
}
.country{
  fill: #eee;
  stroke: none;
  stroke-width:1;
  stroke-linejoin: round;
}
#points{
	width:100%;
	height:100%;
	position:absolute;
  top: 0;
  left:0;
	z-index:100;
}
.tooltip3 {
  position: absolute;
  padding: 15px;
  font: 12px sans-serif;
  background: #fff;
  color: #000;
  border: 0px;
  border-radius: 2px;
  pointer-events: none;
  opacity: 0.8;
  visibility: hidden;
  z-index: 101;
  max-width: 200px;
}
h1{
  font-family: monospace;
  font-weight: normal;
  margin:0px;
}
a{
  color: #007CCA;
}
.show{
  visibility: visible;
}
.hide{
  visibility: hidden;
}
.spot{
  position: relative;
  float: left;
}
#legend{
  position: relative;
  float: left;
  padding:20px;
  background: #fff;
}
.legendwords{
  fill: #000;
  font-size: 14px;
}
</style>
<!-- <h1>victims of police shootings in the US</h1> -->
<svg id="chargesmap" width="960" height="600"></svg>
<svg id="legend"></svg>
<button class="spot">Turn off highlighting</button>

<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://d3js.org/topojson.v2.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<script>

$('.spot').on('click',function(){
  if ($('#outlines').hasClass('show')){
    $('#outlines').removeClass('show')
    $('#outlines').addClass('hide')
    $('.spot').html('Turn on highlighting')
  }else if ($('#outlines').hasClass('hide')){
    $('#outlines').removeClass('hide')
    $('#outlines').addClass('show')
    $('.spot').html('Turn off highlighting')
  }
})
var chargesmap = d3.select("#chargesmap"),
    width = +chargesmap.attr("width"),
    height = +chargesmap.attr("height");

var projection = d3.geoAlbersUsa()
.scale([1285])

.translate([width/2,height/2]); // just temporary

var path = d3.geoPath()
.projection(null);

    d3.queue()
        .defer(d3.json, "https://d3js.org/us-10m.v1.json")
        .defer(d3.csv, "../MPV.csv" )
        .await(ready);

    function ready(error, us, dataset) {
      if (error) throw error;

      chargesmap.append("g")
          .attr("class", "counties")
        .selectAll("path")
        .data(topojson.feature(us, us.objects.counties).features)
        .enter().append("path")
          .attr("fill", '#fff')
          .attr("d", path)

      chargesmap.append("path")
          .datum(topojson.mesh(us, us.objects.states, function(a, b) { return a !== b; }))
          .attr("class", "states")
          .attr("d", path);

      chargesmap.append("g")
          .attr("class", "country")
        .selectAll("path")
        .data(topojson.feature(us, us.objects.nation).features)
        .enter().append("path")
          .attr("d", path)

      var outlines = d3.select('#chargesmap').append('svg').attr('id','outlines').attr('class','show')
      outlines.selectAll("circle").data(dataset) //plotted 	locations on map
      .enter()
      .append("circle")
      .attr('class','spotlight')
      .attr("cx", function(d) {return projection([d.Longitude,d.Latitude])[0]})
      .attr("cy", function(d) {return projection([d.Longitude,d.Latitude])[1]})
      .attr("r",function(d){
        var charge = d.charges
        if(charge.includes("Charged") || charge.includes("Sentenced")){return 10}else{return 0};
      })
      .attr('stroke',function(d){
        var dropaquit = d.charges
        if(dropaquit.includes("Charged, Convicted") || dropaquit.includes("Charged with")){return '#ff0000'}else{return 'green'};

      })
      // .attr('stroke','#ff0000')
      .attr('stroke-opacity',.3)
      .attr('stroke-width',1)
      .style("fill", '#fff')
      .style('opacity',.9)
      .on("mouseover", function(d) {
        var tooltip_str3 = 'Victim:<br/>' + d.name + ", " + d.date + '<br/>' +
        d.race + ', ' + d.age + ', ' + d.gender + '<br/><br/>Charges:<br/>' + d.charges
        tooltip3.html(tooltip_str3)
            .style("visibility", "visible");
      })
      .on("mousemove", function(d) {
        tooltip3.style("top", event.pageY - (tooltip3.node().clientHeight + 5) + "px")
            .style("left", event.pageX - (tooltip3.node().clientWidth / 2.0) + "px");
      })
      .on("mouseout", function(d) {
        points.selectAll('.month')
            .classed('active', false)
        tooltip3.style("visibility", "hidden");
      })

      var points = d3.select('#chargesmap').append('svg').attr('id','points')
      points.selectAll("circle").data(dataset) //plotted 	locations on map
    	.enter()
    	.append("circle")
    	.attr("cx", function(d) {return projection([d.Longitude,d.Latitude])[0]})
    	.attr("cy", function(d) {return projection([d.Longitude,d.Latitude])[1]})
    	.attr("class", function(d){
        var charge = d.charges
        if(charge.includes("Charged") || charge.includes("Sentenced")){return 'charged'}else{return 'not_charged'};
      })
      .attr("r",1.2)
      .style("fill", function(d){
            return charged(d);
        })
      .on("mouseover", function(d) {
        var tooltip_str3 = 'Victim:<br/>' + d.name + ", " + d.date + '<br/>' +
        d.race + ', ' + d.age + ', ' + d.gender + '<br/><br/>Charges:<br/>' + d.charges
        tooltip3.html(tooltip_str3)
            .style("visibility", "visible");
      })
      .on("mousemove", function(d) {
        tooltip3.style("top", event.pageY - (tooltip3.node().clientHeight + 5) + "px")
            .style("left", event.pageX - (tooltip3.node().clientWidth / 2.0) + "px");
      })
      .on("mouseout", function(d) {
        points.selectAll('.month')
            .classed('active', false)
        tooltip3.style("visibility", "hidden");
      })

      var tooltip3 = d3.select("body").append("div")
              .attr("class", "tooltip3");
    };

    legendlabels = ["criminal charges", "no criminal charges", "charged and convicted", "charged, but aquitted or mistrial or charges dropped"]

    legend = d3.select('#legend').append('g')

    legend.selectAll('circle').data(legendlabels)
    .enter().append('circle')
    .attr('cx', 10)
    .attr('cy',function(d,i){return i * 25 + 15})
    .attr('r',function(d,i){if (i <= 1){return 1.2}else{return 10}})
    .attr('stroke-width', 1)
    .attr('fill',function(d,i){if (i == 0){return '#ff0000'}else if (i == 1){return '#999'}else{return 'none'}})
    .attr('stroke',function(d,i){if (i == 2){return '#ff0000'}else if (i == 3){return 'green'}else{return 'none'}})

    legendw = d3.select('#legend').append('g')

    legendw.selectAll('text').data(legendlabels)
    .enter().append('text')
    .attr('x',30)
    .attr('y',function(d,i){return i * 25 + 20})
    .html(function(d){return d})


    function addCommas(x) {
      var parts = x.toString().split('.');
      parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ',');
      return parts.join('.');
    }

    function charged(d){
      if (d.charges == "No known charges" || d.charges == "No Known Charges" || d.charges ==
      "No" || d.charges == "NO" || d.charges ==
      "Charged, Acquitted" || d.charges ==
      "Civil Citation, But No Criminal Charges" || d.charges ==
      "Charged, Charges Tossed" || d.charges ==
      "Charged with perjury, Charges dropped" || d.charges ==
      "Charged, Mistrial" || d.charges ==
      "Charged, Mistrial, Plead Guilty to Civil Rights Charges"){return "#999"}
      else if (d.charges == "Charged with a crime" || d.charges == "Charged, Convicted, Sentenced to 40 years in prison" || d.charges ==
      "Charged, Convicted, Sentenced to 5 years in prison" || d.charges == "Charged, Convicted, Sentenced to 3 months in jail" || d.charges ==
      "Charged, Convicted, Sentenced to 30 years in prison" || d.charges == "Charged, Convicted" || d.charges ==
      "Charged, Convicted, Sentenced to 2.5 years in prison" || d.charges == "Charged, Convicted, Sentenced to 4 years" || d.charges ==
      "Charged, Convicted (two officers) of cruelty to an inmate, public records fraud, and perjury. Sentenced to one month in jail and three yearsâ€™ probation" || d.charges ==
      "Charged, Convicted, Sentenced to 5 years probation." || d.charges == "Charged, Convicted, Sentenced to 20 years in prison" || d.charges ==
      "Charged, Convicted, Sentenced to 16 years in prison" || d.charges == "Charged, Convicted, Sentenced to 1 year in prison" || d.charges ==
      "Charged, Convicted, Sentenced to 4 years in prison, 3 years probation" || d.charges == "Charged, Convicted, Sentenced to life in prison without parole, plus 16 years" || d.charges ==
      "Charged, Convicted, Sentenced to life in prison" || d.charges == "Charged, Convicted, Sentenced to Life in Prison" || d.charges ==
      "Charged, Convicted, Sentenced to 7 years in prison" || d.charges == "Charged, Convicted, Sentenced to 3 years probation " || d.charges ==
      "Charged, Convicted of murder, Sentenced to 30 years in prison" || d.charges ==
      "Charged, Convicted of criminally negligent homicide, Sentenced to 1-3 years in prison" || d.charges ==
      "Charged, Convicted, Sentenced to 120 days in jail, 3 years probation" || d.charges ==
      "Charged, Convicted of involuntary manslaughter, DUI and recklessly endangering another person, Sentenced to 2-7 years" || d.charges ==
      "Charged, Convicted, Sentenced to 50 years" || d.charges ==
      "Charged, Convicted, Sentenced to 1 year in jail, 3 years suspended" || d.charges ==
      "Charged, Convicted, Sentenced to 18 months" || d.charges ==
      "Charged, Convicted, Sentenced to 6 years"){return "#ff0000"}else{return "#333"}
    }
</script>
